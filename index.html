<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Theme Made By www.w3schools.com - No Copyright -->
    <title>AdultDataProject</title>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.2/d3.min.js">
    <script src="https://d3js.org/d3.v4.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
      body {
        font: 20px Montserrat, sans-serif;
        line-height: 1.8;
        color: #080808;
      }

      p {
        font-size: 16px;
      }

      .margin {
        margin-bottom: 45px;
      }

      .bg-1 {
        background-color: #f5f6f7;
        /* Green */
        color: #000000;
      }

      .bg-2 {
        background-color: #474e5d;
        /* Dark Blue */
        color: #ffffff;
      }

      .bg-3 {
        background-color: #ffffff;
        /* White */
        color: #555555;
      }

      .bg-4 {
        background-color: #2f2f2f;
        /* Black Gray */
        color: #fff;
      }

      .container-fluid {
        padding-top: 70px;
        padding-bottom: 70px;
      }

      .navbar {
        padding-top: 15px;
        padding-bottom: 15px;
        border: 0;
        border-radius: 0;
        margin-bottom: 0;
        font-size: 12px;
        letter-spacing: 5px;
      }

      .navbar-nav li a:hover {
        color: #1abc9c !important;
      }


      .rectangle {
  			fill: steelblue;
  		}
  		.rectangle:hover {
  			fill: orange;
  		}
      .axis {
    		font: 10px sans-serif;
  		}

  	.axis path,
  	.axis line {
    	fill: none;
    	stroke: #000;
    	shape-rendering: crispEdges;
  	}
	
	.slidecontainer {
	  width: 80%; /* Width of the outside container */
	  position: relative;
	  left: 10%;
	  display: inline-block;
	}
	
	/* The slider itself */
	.slider {
	  -webkit-appearance: none;  /* Override default CSS styles */
	  appearance: none;
	  width: relative;
	  width: 1%; /* Full-width */
	  height: 25px; /* Specified height */
	  background: #d3d3d3; /* Grey background */
	  outline: none; /* Remove outline */
	  opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
	  -webkit-transition: .2s; /* 0.2 seconds transition on hover */
	  transition: opacity .2s;
	}

	/* Mouse-over effects */
	.slider:hover {
	  opacity: 1; /* Fully shown on mouse-over */
	}

	/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
	.slider::-webkit-slider-thumb {
	  -webkit-appearance: none; /* Override default look */
	  appearance: none;
	  width: 25px; /* Set a specific slider handle width */
	  height: 25px; /* Slider handle height */
	  background: #4CAF50; /* Green background */
	  cursor: pointer; /* Cursor on hover */
	}

	.slider::-moz-range-thumb {
	  width: 25px; /* Set a specific slider handle width */
	  height: 25px; /* Slider handle height */
	  background: #4CAF50; /* Green background */
	  cursor: pointer; /* Cursor on hover */
	}

    </style>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target="#myNavbar"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#home">AdultDataProject</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#views">Vues</a></li>
            <li><a href="#category">Categories</a></li>
            <li><a href="#days">Jours</a></li>
            <li><a href="#cost">Cout</a></li>
            <li><a href="#visu">Petinence</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Home -->
    <div class="container-fluid bg-1 text-center" id="home">
      </br>
      </br>
      <h2>Ce site est notre projet de Data Viz sur le thème de la consomation de vidéos pour adulte.</h2>
      <h3>Avec les données de </h3><img src=" https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/Pornhub-logo.svg/120px-Pornhub-logo.svg.png" alt="Logo Pornhub" />
      <div class="container-fluid bg-1 text-center" id="views">

</br>
  <div class="col-sm-6">
    <h2>Pour qui ?</h2>
    </br>
    <p>
      Ces graphes s'adressent principalement aux personnes qui souhaite uplaoder des vidéos mais aussi aux distributeurs.
      Ils sont aussi adaptés pour le grand public afin d'avoir une vue sur les tendances du site.
      Sachant qu'environ <b>10%</b> des vidéos sont supprimées par la suite, autant réfléchir en amont et éviter une consomation de ressources inutiles.
    </p>
  </div>
  <div class="col-sm-6">
  <h2>Pourquoi ?</h2>
</br>
  <p>
      Les vidéos pour adulte représentent plus de <b>30%</b> d'internet et represente un coût énorme en stockage et en transfert.
      En 2019, Pornhub accueillait <b>115 millions de visite par jour</b>, ce qui correspond à 18 000 terabytes de données transféré par jour. 
      Soit <b>6597 Petabytes</b> cette année, ce qui fait une consomation énergétique énorme.
      Et il est important de donner aux sites mais aussi aux auteurs des indices quant à la pertinence des vidéos afin de réduire son coût énérgétique.
    
      
    </p>
  </div>
    </div>
	</div>
  </nav>
  <div class="container-fluid bg-1 text-center" id="views">

  </br>
  </br>
    <div class="col-sm-4">
      </br>
      </br>
      <p>
        Ce graphe présente l'évolution du nombre de vue en fonction de la
          date. Ainsi, les jours de grandes influences sont visible pour
          déterminer les periodes qui génére un grand trafic. Il peut être
          interessant de proposer des solutions lors des periodes creuses afin
          de réduire la consomation d'énergie du site.
      </p>
    </div>
    <div class="col-sm-8">
      <div id="views_graph">
        <script>
            // Set the dimensions of the canvas / graph
            var marginviews = { top: 70, right: 50, bottom: 30, left: 70 },
              widthviews = 600 - marginviews.left - marginviews.right,
              heightviews = 270 - marginviews.top - marginviews.bottom;

            // Parse the date / time
            // "29-11-2019 21:00:02"
            var parseDateviews = d3.timeParse("%d-%m-%Y %H:%M:%S");

            // Set the ranges
            var xviews = d3.scaleTime().range([0, widthviews]);
            var yviews = d3.scaleLinear().range([heightviews, 0]);

            // Define the axes

            var xAxisviews = d3.axisBottom(xviews).ticks(5);
            var yAxisviews = d3.axisLeft(yviews).ticks(5);

            // Define the line
            var valuelineviews = d3
              .line()
              .x(function(d) {
                return xviews(d.date);
              })
              .y(function(d) {
                return yviews(d.views);
              });

            // Adds the svg canvas
            var svgviews = d3
              .select("#views_graph")
              .append("svg")
              .attr("width", widthviews + marginviews.left + marginviews.right)
              .attr(
                "height",
                heightviews + marginviews.top + marginviews.bottom
              )
              .append("g")
              .attr(
                "transform",
                "translate(" + marginviews.left + "," + marginviews.top + ")"
              );

            function addTooltip() {
              // Création d'un groupe qui contiendra tout le tooltip plus le cercle de suivi
              var tooltip = svgviews
                .append("g")
                .attr("id", "tooltip")
                .style("display", "none");

              // Le cercle extérieur bleu clair
              tooltip
                .append("circle")
                .attr("fill", "#CCE5F6")
                .attr("r", 10);

              // Le cercle intérieur bleu foncé
              tooltip
                .append("circle")
                .attr("fill", "#3498db")
                .attr("stroke", "#fff")
                .attr("stroke-width", "1.5px")
                .attr("r", 4);

              // Le tooltip en lui-même avec sa pointe vers le bas
              // Il faut le dimensionner en fonction du contenu
              tooltip
                .append("polyline")
                .attr("points", "0,-10 0,40 55,40 60,45 65,40 120,40 120,-10 0,-10")
                .style("fill", "#f9f9f9")
                .style("stroke", "#3498db")
                .style("opacity", "0.9")
                .style("stroke-width", "1")
                .attr("transform", "translate(-50, -45)");

              // Cet élément contiendra tout notre texte
              var textviews = tooltip
                .append("text")
                .style("font-size", "13px")
                .style("font-family", "Segoe UI")
                .style("color", "#333333")
                .style("fill", "#333333")
                .attr("transform", "translate(-32, -40)");

              // Element pour la date avec positionnement spécifique
              textviews
                .append("tspan")
                .attr("dx", "-20")
                .attr("id", "tooltip-date");

              // Positionnement spécifique pour le petit rond	bleu
              textviews
                .append("tspan")
                .style("fill", "#3498db")
                .attr("dx", "-110")
                .attr("dy", "15")
                .text("●");

              textviews
                .append("tspan")
                .attr("dx", "5")
                .text("Views : ");

              textviews
                .append("tspan")
                .attr("id", "tooltip-views")
                .style("font-weight", "bold");

              textviews
                .append("tspan")
                .style("fill", "#3498db")
                .attr("dx", "-110")
                .attr("dy", "15")
                .text("●");

              textviews
                .append("tspan")
                .attr("dx", "5")
                .text("Cost : ");
                
              textviews
                .append("tspan")
                .attr("id", "tooltip-cost")
                .style("font-weight", "bold");

              return tooltip;
            }

            var tooltip = addTooltip();

            var bisectDate = d3.bisector(function(d) {
              return d.date;
            }).left;

            // Get the data
            d3.csv(
              "https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/newView.csv",
              function(error, data) {
                data.forEach(function(d) {
                  d.dateO = d.date;
                  d.date = parseDateviews(d.date);
                  d.views = d.views;
                  d.cost = d.cost;
                });

                // Scale the range of the data
                xviews.domain(
                  d3.extent(data, function(d) {
                    return d.date;
                  })
                );
                yviews.domain([
                  0,
                  d3.max(data, function(d) {
                    return d.views;
                  })
                ]);

                // Add the valueline path.
                svgviews
                  .append("path")
                  .attr("class", "line")
                  .attr("fill", "none")
                  .attr("stroke", "steelblue")
                  .attr("stroke-width", 1.5)
                  .attr("d", valuelineviews(data));

                // Add the X Axis
                svgviews
                  .append("g")
                  .attr("class", "x axis")
                  .attr("transform", "translate(0," + heightviews + ")")
                  .call(xAxisviews);

                // Add the Y Axis
                svgviews
                  .append("g")
                  .attr("class", "y axis")
                  .call(yAxisviews);

                function mousemoveviews() {
                  var x0views = xviews.invert(d3.mouse(this)[0]),
                    iviews = bisectDate(data, x0views),
                    dviews = data[iviews];
                  tooltip.style("z-index", "400")
                  tooltip.attr(
                    "transform",
                    "translate(" +
                      xviews(dviews.date) +
                      "," +
                      yviews(dviews.views) +
                      ")"
                  );

                  d3.select("#tooltip-date").text(dviews.dateO);
                  d3.select("#tooltip-views").text(dviews.views);
                  d3.select("#tooltip-cost").text(dviews.cost);
                }

                svgviews
                  .append("rect")
                  .attr("class", "overlay")
                  .attr("width", widthviews)
                  .attr("fill", "transparent")
                  .attr("height", heightviews)
                  .on("mouseover", function() {
                    tooltip.style("display", null);
                  })
                  .on("mouseout", function() {
                    tooltip.style("display", "none");
                  })
                  .on("mousemove", mousemoveviews);

                svgviews
                  .append("text")
                  .attr("x", widthviews / 2)
                  .attr("y", 0 - marginviews.top / 2)
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .style("text-decoration", "underline")
                  .text("Evolution du nombre de vue par date");
              }
            );
          </script></div>
    </div>
  </div>
  <div class="container-fluid bg-1 text-center" id="days">

</br>
</br>
    <div class="col-sm-4">

    </br>
    </br>
      <p>
        Ce graphe représente la consommation en fonction des jours de la semaine.
    il permet de voir que la fréquentation est beaucoup plus forte en fin de
     semaine qu'en milieu. Il serait donc peut ëtre judicieux de diminuer les
     ressources allouées pendant la semaine
      </p>
    </div>
    <div class="col-sm-8">
      <div id="days_graph">
    <script>
      var width = 700;
      var height = 500;
      var marginWidth = width * 0.2;
      var marginHeight = height * 0.2;

      var svg_days = d3.select("#days_graph").append("svg")
        .attr("width", width)
        .attr("height", height)

      svg_days.append("text")
        .text("Consommation de vidéos adultes en fonction des jours")
        .attr("x", width / 2)
                .attr("y", 35 - 40 / 2)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("text-decoration", "underline")

      var days;


      d3.json("https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/days.json", function(data){

        days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]


        var dataParsed = days.map(
        function(key) {
          var dict = {};
          dict["day"] = key
          dict["value"] = parseInt(data[key])
          return dict;
        }
        )
        //console.log(dataParsed)


        var total = 0;
        dataParsed.map(function(d){
        total += d.value
        })



        maxima = 0

          dataParsed.forEach(function(d){
        if (d["value"] > maxima){
          maxima = d["value"]
        }
        })

        //console.log(maxima)


        var height_ = d3.scaleLinear()
        .domain([0,maxima])
        .range([0 , height - marginHeight]);

        var x = d3.scaleLinear()
        .domain([0,days.length])
        .range([marginWidth, width * 0.95 ]);

        var yperCent = d3.scaleLinear()
        .domain([0,Math.floor(1 + maxima/total * 100)])
        .range([height - marginHeight / 2 , marginHeight / 2]);


        svg_days.selectAll("rect").data(dataParsed).enter()
            .append("rect")
            .attr("height", function(d) {
          return height_(d.value);
        }).attr("width", (width - marginWidth) * 0.90 / (days.length + 1))
            .attr("y", function(d) {
        return  height - marginHeight/2 - height_(d.value); })
            .attr("x",  function(d,i) { return x(i); })
            .style("fill", function(d){ return "steelblue"})


        svg_days.selectAll("text25").data(dataParsed).enter()
        .append("text")
        .text(function(d){ return d.day })
        .attr("x", function(d,i){return x(i) + ((width - marginWidth) / (days.length +1))/2})
        .attr("y", height - marginHeight / 4)
        .attr("font-size", 12)
        .attr("font-family", "monospace");


        var tab = []
        for(let i = 0; i < 1 + maxima/total * 100; i++){
        tab.push(i)
        }

        svg_days.selectAll("text54").data(tab).enter()
        .append("text")
        .text(function(d){
        return d + "%"
        })
        .attr("y", function(d,i){
        return yperCent(d);
        })
        .attr("x", margin/2)
        .attr("font-size", 12)
        .attr("font-family", "monospace");

      });



      </script>
  </div>
    </div>

  </div>
  <div class="container-fluid bg-1 text-center" id="category">

  </br>
  </br>
    <div class="col-sm-8">
      <div id="category_graph">
		<div id="select-section">
			<label for="cats">Nombre de catégories (1-99):</label>

			<input type="number" id="nb_cats" name="nombre"
			   min="1" max="99" value="15">
		
			<div class="slidecontainer">
			  <input type="range" min="0" max="1" value="1" class="slider" id="slider_start" style="width:49%; display: inline-block;">
			  <input type="range" min="1" max="2" value="2" class="slider" id="slider_end" style="width:49%; display: inline-block;">
			</div>
		</div>
		
		<script>
			// ---------------------------------------------------------------------------------------------
		  // SCRIPT CATEGORIES
		  
		  var margin = {
              top: 40,
              right: 40,
              bottom: 30,
              left: 150
            };
            (width = 900 - margin.left - margin.right),
              (height = 500 - margin.top - margin.bottom);

		  
		  var display_cats = function(begin,finish,nb_display){
			d3.json("https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/category.json", function(data){
			
			d3.select("#svg_cats").remove();
			var diff  = [];
			var cats = [];

			dates = Object.keys(data)
			Object.keys(data[dates[0]]).forEach( cat => cats.push(cat))


			var svg = d3.select("#category_graph").append("svg")
			.attr("width", width)
			.attr("height", height)
			.attr("id", "svg_cats")


			svg.append("text")
                  .attr("x", width / 2)
                  .attr("y", 35 - margin.top / 2)
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .style("text-decoration", "underline")
			.text("Parts des catégories les plus populaires dans la consommation globale")

			var data2 = dates.map(
			  function(key) {
				var dict = {};
				dict["date"] = key
				Object.keys(data[key]).forEach(
				  function(key2) {
					dict[key2] = data[key][key2]
				  }
				)
				return dict;
			  }
			)

			var total = 0;
			diff = cats.map(function(cat){
				var dict = { id: cat,
				value : data[finish][cat] - data[begin][cat]}
				total += dict.value
				return dict;
			})
			

			var best = [];
			var minVal = 1000000000;
			for(let i = 0; i < cats.length; i++){
			  if (best.length < nb_display){
				best.push(i)

				if (diff[i]["value"] < minVal){
				  minVal = diff[i]["value"]
				}
			  } else {
				if (diff[i]["value"] > minVal){
				  for(let j = 0; j < nb_display; j++){
					if (diff[best[j]].value == minVal){
					  best[j] = i
					  break;
					}
				  }
				  minVal = Number.MAX_VALUE;
				  for(let j = 0; j < nb_display; j++){
					if (diff[best[j]]["value"] < minVal){
					  minVal = diff[best[j]]["value"]
					}
				  }
				}
			  }
			}


			var to_display = diff.filter(function(d,i){
			  for(let j = 0; j < cats.length; j++){
				if (i == best[j]){
				  return true;
				}
			  }
			  return false;
			});

			maxima = 0

			to_display.forEach(function(d){
			  if (d["value"] > maxima){
				maxima = d["value"]
			  }
			})

			function keysrt(key,desc) {
			  return function(a,b){
			   return desc ? ~~(a[key] > b[key]) : ~~(a[key] < b[key]);
			  }
			}
			to_display.sort(keysrt("value"))

			var width_ = d3.scaleLinear()
			.domain([0,maxima])
			.range([width - 150 , 0.05 * width]);

			var y = d3.scaleLinear()
			.domain([0,parseInt(nb_display) + 1])
			.range([height * 0.1, height]);

			var xperCent = d3.scaleLinear()
			.domain([0,Math.floor(1 + to_display[0].value/total * 100)])
			.range([150 , width - 20]);


			svg.selectAll("rect").data(to_display).enter()
					.append("rect")
					.attr("width", function(d) {
				return width - (150 + width_(d["value"]));
			  }).attr("height", (height * 0.8) / (parseInt(nb_display) + 1))
					.attr("x", function(d) { return  150; })
					.attr("y",  function(d,i) { return y(i); })
					.style("fill", function(d){ return "steelBlue"})

			d3.json("https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/cat_userfriendly.json", function(dataAno){

			  svg.selectAll("text25").data(to_display).enter()
			  .append("text")
			  .text(function(d){
				return dataAno[d.id]
			  })
			  .attr("y", function(d,i){return y(i) + ((height * 0.8) / (nb_display + 1))/2})
			  .attr("x", 10)
			  .attr("font-size", 12)
			  .attr("font-family", "monospace");

			})

			var tab = []
			for(let i = 0; i < 1 + to_display[0].value/total * 100; i++){
			  tab.push(i)
			}

			svg.selectAll("text2").data(tab).enter()
			.append("text")
			.text(function(d){
			  return d + "%"
			})
			.attr("y", height *0.99)
			.attr("x", function(d){
				return xperCent(d);
			})
			.attr("font-size", 12)
			.attr("font-family", "monospace");

		    });
		  }

		  d3.json("https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/category.json", function(data){

			  keys = Object.keys(data)
			
			var slider_start = document.getElementById("slider_start");
			var slider_end = document.getElementById("slider_end");
			
			slider_start.value = 0;
			slider_start.max = keys.length - 2;
			slider_end.max = keys.length-1;
			slider_end.value = keys.length-1;
			
			display_cats(keys[slider_start.value],keys[slider_end.value],d3.select("#nb_cats").node().value)
			
			d3.select("#select-section").on("change", function(d) {
			  
			  var slider_start = document.getElementById("slider_start");
			  var slider_end = document.getElementById("slider_end");
			  
			  if (slider_start.value >= slider_end.value){
				slider_end.value = slider_start.value + 1
			  }
				
			  display_cats(keys[slider_start.value],keys[slider_end.value],d3.select("#nb_cats").node().value)
			})
		  })

		  


		  //------------------------------- FIN CATEGORIES --------------------------------------------------
		</script>

	  </div>
    </div>
    <div class="col-sm-4">

    </br>
      </br>
      <p>
        Ce graphe représente l'impact des différentes catégories dans la
		consommation globale de vidéos. Il pourrait être intéressant de
		voir si certaines catégories sont trop représentées par rapport à
		leur demande, afin de réduire l'offre de ces catégories et donc
		d'éviter du stockage de données inutiles.
      </p>
    </div>
  </div>


  <div class="container-fluid bg-1 text-center" id="cost">

</br>
</br>
    <div class="col-sm-8">
      <div id="cost_graph">
        <script>
          var margin = {
            top: 40,
            right: 40,
            bottom: 30,
            left: 150
          };
          (width = 900 - margin.left - margin.right),
            (height = 500 - margin.top - margin.bottom);

          // append the svg object to the body of the page
          var svg = d3
            .select("#cost")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr(
              "transform",
              "translate(" + margin.left + "," + margin.top + ")"
            );

          d3.json(
            "https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/data.json",
            function(json) {
              var data_raw = Array.from(Object.values(json));
              var data = [];

              data_raw.map(function(d) {
                if (d.duration != "None") data.push(d);
              });

              data.map(function(d) {
                view = d3.max(d.evolution, function(t) {
                  return +t.views;
                });
                d.view = view;
              });

              var x = d3
                .scaleLinear()
                .range([0, width])
                .nice();

              var y = d3.scaleLinear().range([height, 0]);

              var xAxis = d3.axisBottom(x).ticks(12);
              var yAxis = d3.axisLeft(y).ticks((12 * height) / width);

              var brush = d3
                  .brush()
                  .extent([
                    [0, 0],
                    [width, height]
                  ])
                  .on("end", brushended),
                idleTimeout,
                idleDelay = 350;

              var tooltip = d3
                .select("#cost")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px");

              var mouseover = function(d) {
                console.log(d);
                console.log("Test");
                tooltip.style("opacity", 1);
              };

              var mousemove = function(d) {
                console.log(d);
                console.log("Test");
                tooltip;

                /*
            .style("left", (d3.mouse(this)[0] + 90) +
                "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
            .style("top", (d3.mouse(this)[1]) + "px")
            */
              };

              var mouseleave = function(d) {
                console.log(d);
                console.log("Test");
                tooltip
                  .transition()
                  .duration(200)
                  .style("opacity", 0);
              };

              var clip = svg
                .append("defs")
                .append("svg:clipPath")
                .attr("id", "clip")
                .append("svg:rect")
                .attr("width", width)
                .attr("height", height)
                .attr("x", 0)
                .attr("y", 0);

              var xExtent = d3.extent(data, function(d) {
                return d.duration;
              });

      var yExtent = d3.extent(data, function(d) {
                return d.view;
              });


              x.domain(
                d3.extent(data, function(d) {
                  return d.duration;
                })
              ).nice();
              y.domain(
                d3.extent(data, function(d) {
                  return d.view;
                })
              ).nice();

              var scatter = svg
                .append("g")
                .attr("id", "scatterplot")
                .attr("clip-path", "url(#clip)");

              scatter
                .selectAll(".dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("class", "dot")
                .attr("r", 4)
                .attr("cx", function(d) {
                  return x(d.duration);
                })
                .attr("cy", function(d) {
                  return y(d.view);
                })
                .attr("opacity", 0.5)
                .style("fill", "#4292c6")
                .style("pointer-events", "none")
                .on("mousemove", mousemove)
                .on("mouseout", mouseleave)
                .on("mouseover", mouseover);

              // x axis
              svg
                .append("g")
                .attr("class", "x axis")
                .attr("id", "axis--x")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

              svg
                .append("text")
                .style("text-anchor", "end")
                .attr("x", width)
                .attr("y", height - 8)
                .text("Durée");

              // y axis
              svg
                .append("g")
                .attr("class", "y axis")
                .attr("id", "axis--y")
                .call(yAxis);

              svg
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "1em")
                .style("text-anchor", "end")
                .text("Vues");

              scatter
                .append("g")
                .attr("class", "brush")
                .call(brush);

              function brushended() {
                var s = d3.event.selection;
                if (!s) {
                  if (!idleTimeout)
                    return (idleTimeout = setTimeout(idled, idleDelay));
                  x.domain(
                    d3.extent(data, function(d) {
                      return d.duration;
                    })
                  ).nice();
                  y.domain(
                    d3.extent(data, function(d) {
                      return d.view;
                    })
                  ).nice();
                } else {
                  x.domain([s[0][0], s[1][0]].map(x.invert, x));
                  y.domain([s[1][1], s[0][1]].map(y.invert, y));
                  scatter.select(".brush").call(brush.move, null);
                }
                zoom();
              }

              function idled() {
                idleTimeout = null;
              }

              function zoom() {
                var t = scatter.transition().duration(750);
                svg
                  .select("#axis--x")
                  .transition(t)
                  .call(xAxis);
                svg
                  .select("#axis--y")
                  .transition(t)
                  .call(yAxis);
                scatter
                  .selectAll("circle")
                  .transition(t)
                  .attr("cx", function(d) {
                    return x(d.duration);
                  })
                  .attr("cy", function(d) {
                    return y(d.view);
                  });
              }
              svg
                .append("text")
                .attr("x", width / 2)
                .attr("y", 15 - margin.top / 2)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("text-decoration", "underline")
                .text("Mapping des vidéos par rapport à leurs nombres de vues et leurs durées.");
            }

          );
      </script>
      </div>
    </div>
    <div class="col-sm-4">

    </br>
    </br>
      <p>
        Ce graphe présente les vidéos collectées par rapport à leurs durées en
        secondes et leurs nombres de vues. Ainsi, les vidéos les plus longues
        représentent un enjeu en terme de stockage dans les datacenters et les
        vidéos les plus vues un enjeu en trafic. On peut voir que la majorité
        des vidéos qui sont stockées dans les datacenters sont très peu vues,
        il serait intéressant de procéder à un "nettoyage" quand une vidéo est
        assez longue et ne rencontre pas une certaine popularité, en vu de
        réduire les consommations énergétiques.

        On peut zoomer le graphe en sélectionnant une zone.
        La durée est exprimée en secondes.
      </p>
    </div>
  </div>

  <div class="container-fluid bg-1 text-center" id="visu">

</br>
</br>
    <div class="col-sm-8">
      <div id="visu_graph">
        <script>

           var canvas = d3.select("#visu_graph").append("svg")
             .attr("width", 900)
             .attr("height", 700)
             .append("g")
               .attr("transform","translate(50,0)");




           const widthD = 800//document.body.clientWidth;
           const heightD =600// document.body.clientHeight;
           const marginD = { top: 0, right: 70, bottom: 0, left: 40};
           const innerWidth = widthD - marginD.left - marginD.right;
           const innerHeight = heightD - marginD.top - marginD.bottom;

           var tree=d3.layout.tree()
             .size([innerHeight, innerWidth])
             .separation(function(a, b) { return a.parent === b.parent ? 10 : 15; });


         var zoom = d3.behavior.zoom()
             .scaleExtent([0.50, 10])
             .on('zoom', redraw);

           d3.json("https://raw.githubusercontent.com/Origonz/AdultDataProject/master/data/dendogram.json",function(data){
             //console.log(data)
             var nodes=tree.nodes(data);
             //console.log(nodes)
             var links=tree.links(nodes);
             //console.log(links);
             var node=canvas.selectAll(".node")
               .data(nodes)
               .enter()
               .append("g")
                 .attr("class","node")
                 .attr("transform",function(d){return "translate(" + d.y + "," + d.x+")";})
               .on("mouseover", function(d, i) {
               d3.select(this).style("fill", "red");
                 fade(d.id, 0.2);
             })
             .on("mouseout", function(d, i) {
               d3.select(this).style("fill", "black");
               fadeOut()
             })
             .call(zoom)

             node.append("circle")
               .attr("r",1.5)
               .attr("fill","darkblue")

             node.append("text")
               .attr('dy', '0.20em')
               .attr('text-anchor', d =>d.children ? 'middle' : 'start')
               .attr('font-size', d => 2.1 - d.depth + 'em')
               .text(function(d){return "     "+d.id +" " + d.view ;})


             var diagonal=d3.svg.diagonal()
               .projection(function(d){return [d.y,d.x]; })

             canvas.selectAll(".links")
               .data(links)
               .enter()
               .append("path")
               .attr("class","link")
               .attr("fill","none")
               .attr("stroke","#ADADAD")
               .attr("d",diagonal)
               .call(zoom);

             var opacity = d3.scale.sqrt()
                  .domain([d3.min(data, function (d) { return d.depth; }),d3.max(data, function (d) { return d.depth; })])
                  .range([1, .5]);

           })

           function redraw() {
           canvas.attr('transform', 'translate(' + d3.event.translate + ')' +
               ' scale(' + d3.event.scale + ')');
           }



           function fade(c, opacity) {
               canvas.selectAll("circle")
                  .filter(function (d) {
                  return d.id != c;
                  })
                  .transition()
                  .style("opacity", opacity);

           }

           function fadeOut() {
                 canvas.selectAll("circle")
                    .transition()
                    .style("opacity", 1);
           }

         </script>

      </div>
    </div>
    <div class="col-sm-4">

    </br>
    </br>
      <p>
        Ce dendogramme permet de visualiser le nombre de vues par ordre décroissant
        selon les catégories,les titres et les tags.
        Il permet aux vidéastes d'identifier les catégories qui font le plus de vues de même
        que les tags et les mots clés dans les titres de vidéos ainsi cela permet
        d'éviter le stockage des vidéos inutilement et de consommer de l'énergie.
      </p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="container-fluid bg-4 text-center">
    <p>
      AdultDataProject - Pour plus d'info : <a style="color:cornsilk;" href="https://github.com/Origonz/AdultDataProject/wiki">Wiki</a>
    </p>
  </footer>

  <!-- Modal -->
  <div id="myModal" class="modal">

<!-- Modal content -->
<div class="modal-content text-center">
<span class="close">&times;</span>
<p>Vous utilisez un autre navigateur que Firefox, il est possible qu'il y ai des fonctionalités non disponibles ou erronées.</p>
</div>

</div>
  <style>
    /* The Modal (background) */
.modal {
display: none; /* Hidden by default */
position: fixed; /* Stay in place */
z-index: 1; /* Sit on top */
left: 0;
top: 0;
width: 100%; /* Full width */
height: 100%; /* Full height */
overflow: auto; /* Enable scroll if needed */
background-color: rgb(0,0,0); /* Fallback color */
background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
background-color: #fefefe;
margin: 15% auto; /* 15% from the top and centered */
padding: 20px;
border: 1px solid #888;
width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
}

.close:hover,
.close:focus {
color: black;
text-decoration: none;
cursor: pointer;
} 
  </style>
  <script>
    modal = document.getElementById("myModal")
    if(typeof InstallTrigger == 'undefined'){
      modal.style.display = "block";
    }
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>